---
title: "Practical Malware Analysis: Static Analysis"
author: Asier Núñez
pubDatetime: 2025-12-1T13:22:23.365Z
slug: pma-lab01
featured: true
draft: false
tags:
  - Malware Analysis
  - Windows
  - Security
  - Ethical Hacking
description: "Hands-on analysis of Windows malware samples using static techniques from Practical Malware Analysis"
---


## Lab 01-01
---

### 1. Upload the files to [VirusTotal](https://www.virustotal.com/) and view the reports. Does either file match any existing antivirus signatures?

After submitting both Lab01-01.dll and Lab01-01.exe to [VirusTotal](https://www.virustotal.com/), multiple detections appear for each file. Most security vendors classify them as malicious trojans.

Specifically, the executable (.exe) is flagged as malicious by 56 out of 72 vendors under the label `trojan.ulise/aenjaris`, while the library (.dll) receives malicious detections from 39 out of 71 vendors, identified as `trojan.skeeyah/waski`.

### 2. When were the files compiled?

By examining the PE headers with [PEview](http://wjradburn.com/software/), specifically the Time Date Stamp field under `IMAGE_NT_HEADERS > IMAGE_FILE_HEADER`, we can see that both files **were compiled on December 19 2010**.

![PEview](@assets/images/writeups/practical-malware-analysis/Lab01-01-compilation-date.png)

> Caution: Header‑derived compile dates can be misleading—Delphi programs often share a common timestamp, and the values stored in the PE headers can be altered.

### 3. Are there any indications that either of these files is packed or obfuscated? If so, what are the indicators?

No signs of packing or obfuscation were observed.

### 4. Do any imports hint what this malware does? If so, which imports are they?

According to the “Important Windows Functions” Appendix A of *Practical Malware Analysis* [^1], the imports observed in **Lab01‑01.exe** (CreateFile, CreateFileMapping, FindFirstFile, FindNextFile, MapViewOfFile) indicate file‑read/write activity, while the imports in **Lab01‑01.dll** (Sleep, CreateProcess) together with the loading of **WS2_32.dll** suggest process‑creation and networking capabilities.

Key imports from Lab01‑01.exe include:
- **CreateFile**
- **CreateFileMapping**
- **FindFirstFile**
- **FindNextFile**
- **MapViewOfFile**

These suggest the executable performs file‑reading/writing operations.

Imports from Lab01‑01.dll include:
- **Sleep**
- **CreateProcess**

Additionally, the DLL imports **WS2_32.dll**, indicating network capabilities. The functions from WS2_32 are imported by ordinal, so their names aren’t directly visible.

> Complete list of 

![Dependencies](@assets/images/writeups/practical-malware-analysis/Lab01-01-deps.png)


### 5. Are there any other files or host-based indications that you could look for on infected systems?

Running strings on the binaries reveals suspicious file paths such as:

- C:\windows\system32\kerne132.dll
- C:\Windows\System32\Kernel32.dll

![Strings](@assets/images/writeups/practical-malware-analysis/Lab01-01-strings.png)

The first path replaces the letter “l” with a “1”, likely an attempt to masquerade as the legitimate Kernel32.dll.

> Note: Windows does not ship a native strings utility; you’ll need the [SysInternals](https://learn.microsoft.com/en-us/sysinternals/) version.

### 6. What network-based indications could be used to find this malware on infected machines?

Examining the strings extracted from **Lab01‑01.dll** uncovers an IP address. Coupled with the import of **WS2_32.dll**, this points to the DLL making outbound connections to that address

![Strings-DLL](@assets/images/writeups/practical-malware-analysis/Lab01-01-strings-dll.png)

### 7. What would you guess is the purpose of these files?

The DLL appears to act as a backdoor, while the EXE seems designed to drop/install the DLL onto the target system.



## Lab 01-02
---

### 1. Upload the Lab01-02.exe file to [VirusTotal](https://www.virustotal.com/). Does it match any existing antivirus definitions?

Yes. VirusTotal reports that the file matches known malware signatures — specifically, **60 out of 72** antivirus engines flag it as *trojan.ulise/startpage*.

### 2. Are there any indications that the file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Opening the executable with [Detect It Easy](https://github.com/horsicq/Detect-It-Easy) (DIE) — a tool similar to PEiD—shows that the program is packed using UPX (version 3.04).

![DIE](@assets/images/writeups/practical-malware-analysis/Lab01-02-die.png)



Using the [UPX](https://github.com/upx/upx) tool, we can successfully decompress the file with the following command:

```powershell
.\upx.exe -d '..\Practical Malware Analysis\BinaryCollection\Chapter_1L\Lab01-02.exe' -o  '..\Practical Malware Analysis\BinaryCollection\Chapter_1L\Lab01-02-unpacked.exe' 
```

![unpack](@assets/images/writeups/practical-malware-analysis/Lab01-02-unpack.png)

Re-examining the resulting file in DIE confirms that the unpacking process worked.

![DIE-unpacked](@assets/images/writeups/practical-malware-analysis/Lab01-02-die-unpacked.png)

### 3. Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

Yes. Based on Appendix A (“Important Windows Functions”) from Practical Malware Analysis[^1], the imports InternetOpen and InternetOpenUrl suggest that the executable performs network-related operations, likely connecting to or retrieving data from a remote server. 

### 4. What host- or network-based indicators could be used to identify this  malware on infected machines?

Appendix A[^1] explains that InternetOpen uses a **User-Agent** string, which can sometimes serve as a useful network signature.

Examining the program’s printable strings reveals the URL it contacts:
`http://www.malwareanalysisbook.com`.

Additionally, the presence of the CreateService import suggests the malware attempts to install itself as a service, implying **persistence and stealth**, which can function as **host-based indicators**.

## Lab 01-03
---

### 1. Upload the Lab01-03.exe file to VirusTotal. Does it match any existing antivirus definitions?

Yes. VirusTotal reports that the file matches known malware signatures — specifically, **63 out of 72** antivirus engines flag it as *trojan.graftor/genome*.

### 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Yes, there are clear indicators of `Lab01-03.exe` being packed.

![DIE](@assets/images/writeups/practical-malware-analysis/Lab01-03-die.png)


### 3. Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

The question can't be answered without unpacking the file.

### 4. What host- or network-based indicators cold be used to identify this  malware on infected machines?

The question can't be answered without unpacking the file.


## Lab 01-04
---

### 1. Upload the Lab01-04.exe file to VirusTotal. Does it match any existing antivirus definitions?

Yes. According to VirusTotal, the file corresponds to known malware signatures. Specifically, **64 out of 72** antivirus engines detect it as *trojan.cerbu/gofot*.


### 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

No indications suggest that the file is packed or obfuscated.

![DIE](@assets/images/writeups/practical-malware-analysis/Lab01-04-die.png)

> Note: The DIE output shows that there is an embedded program within `Lab01-04.exe`

### 3. When was this program compiled?

![CompilationDate](@assets/images/writeups/practical-malware-analysis/Lab01-04-date.png)


### 4.Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

Imports from *advapi32.dll* suggest manipulation of permissions. The presence of *WinExec*, combined with VirusTotal’s findings, indicates that the malware creates and executes files.

### 5. What host- or network-based indicators could be used to identify this malware on infected machines?

The string *\system32\wupdmgr.exe* suggests the program may create or modify a file in that location. The URL *http://practicalmalwareanalysis.com/updater.exe* indicates that the malware relies on a staging server.

![Strings](@assets/images/writeups/practical-malware-analysis/Lab01-04-strings.png)

### 6. This file has a resource in the resource section. Use ResourceHacker to examine that resource, and then use it to extract the resource. What can you learn from the resource? 

The resource is another PE executable. By extracting it with [Resource Hacker](https://www.angusj.com/resourcehacker/) and analyzing it in PEview, it appears this embedded PE file is responsible for downloading the malware from the previously identified URL.

---

# References

[^1]: M. Sikorski and A. Honig, *Practical Malware Analysis: The Hands‑On Guide to Dissecting Malicious Software*, 2nd ed., No Starch Press, 2012, Appendix A, “Important Windows Functions”.

‌